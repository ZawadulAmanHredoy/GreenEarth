<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Green Earth</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        'brand-green': '#163A24',
        'brand-green-light': '#E9F1EC',
        'brand-yellow': '#FABD20',
        'brand-gray': '#F2F0E4',
      }
    }
  }
}
</script>
<style>
.category-btn.active {
  background-color: #163A24;
  color: white;
  font-weight: bold;
}
.loader {
  border: 8px solid #f3f3f3;
  border-top: 8px solid #163A24;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  animation: spin 1.5s linear infinite;
  margin: 5rem auto;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
</head>
<body class="bg-brand-gray text-brand-green font-sans">

<!-- Header -->
<header class="bg-brand-green sticky top-0 z-50">
<nav class="container mx-auto px-6 py-4 flex justify-between items-center">
  <div class="font-bold text-2xl text-white">Green Earth</div>
  <div class="hidden md:flex space-x-8 font-semibold">
    <a href="#" class="text-white">About</a>
    <a href="#" class="text-white">Gallery</a>
    <a href="#plant-a-tree" class="text-white">Plant a Tree</a>
  </div>
  <a href="#plant-a-tree" class="bg-brand-yellow text-brand-green font-bold py-2 px-6 rounded-md shadow-md hover:bg-yellow-400 transition-colors">Plant a Tree</a>
</nav>
</header>

<main>
<!-- Banner -->
<section class="bg-brand-green-light py-20 relative overflow-hidden">
<div class="container mx-auto px-6 text-center relative z-10">
  <h1 class="text-4xl md:text-6xl font-bold text-brand-green leading-tight">Plant a Tree, Grow a Future</h1>
  <p class="mt-4 text-lg text-gray-700">Join our mission to plant 1 million trees.</p>
  <button class="mt-8 bg-brand-yellow text-brand-green font-bold py-3 px-8 rounded-md shadow-lg hover:bg-yellow-400 transition-colors">Get Involved</button>
</div>
</section>

<!-- Plants -->
<section class="py-16">
<div class="container mx-auto px-6">
  <h2 class="text-3xl font-bold text-center mb-12 text-brand-green">Choose Your Trees</h2>
  <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">

    <!-- Categories -->
    <aside id="categories-container" class="lg:col-span-1">
      <h3 class="font-bold text-xl mb-4">Categories</h3>
      <ul class="space-y-2"></ul>
    </aside>

    <!-- Plants -->
    <div class="lg:col-span-3">
      <div id="spinner" class="loader hidden"></div>
      <div id="plants-container" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8"></div>
    </div>

    <!-- Cart -->
    <aside class="lg:col-span-1 bg-white p-6 rounded-lg shadow-md h-fit">
      <h3 class="font-bold text-xl mb-4">Your Cart</h3>
      <div id="cart-items-container" class="space-y-3"></div>
      <hr class="my-4">
      <div class="flex justify-between font-bold text-lg">
        <span>Total</span>
        <span id="cart-total">$0.00</span>
      </div>
    </aside>
  </div>
</div>
</section>

<!-- About -->
<section class="py-16 bg-white">
  <div class="container mx-auto px-6">
    <h2 class="text-3xl font-bold mb-12 text-center text-brand-green">About the Campaign</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
      <div class="flex justify-center">
        <img src="assets/about.png" alt="A healthy green plant" class="rounded-lg shadow-xl max-w-sm w-full">
      </div>
      <div>
        <p class="text-gray-700 mb-4">
          Green Earth is a global tree-planting initiative. We've planted over 500,000 trees worldwide.
        </p>
        <ul class="list-disc list-inside text-gray-700 space-y-2">
          <li>Restoration of natural habitats.</li>
          <li>Promotion of biodiversity.</li>
          <li>Support for local communities.</li>
        </ul>
      </div>
    </div>
  </div>
</section>


<!-- Plant a Tree -->
<section id="plant-a-tree" class="py-16 bg-brand-green">
  <div class="container mx-auto px-6 max-w-2xl text-center">
    <div class="rounded-lg shadow-lg border border-green-300 p-8" style="background-color: #15803D;">
      <h2 class="text-3xl font-bold mb-8 text-white">Plant a Tree Today</h2>
      <form class="space-y-4">
        <input type="text" placeholder="Your Name" class="w-full p-3 rounded-md border-0 focus:ring-2 focus:ring-yellow-400">
        <input type="email" placeholder="Email Address" class="w-full p-3 rounded-md border-0 focus:ring-2 focus:ring-yellow-400">
        <input type="number" min="1" placeholder="Number of Trees" class="w-full p-3 rounded-md border-0 focus:ring-2 focus:ring-yellow-400">
        <button type="submit" class="w-full bg-yellow-400 text-brand-green font-bold py-3 rounded-md shadow-lg hover:bg-yellow-300 transition-colors">Donate to Plant</button>
      </form>
    </div>
  </div>
</section>





</main>

<!-- Footer -->
<footer class="bg-brand-gray py-6">
<div class="container mx-auto px-6 text-center text-gray-600">
  <p>&copy; 2025 Green Earth Inc. All Rights Reserved.</p>
</div>
</footer>

<!-- Modal -->
<div id="plant-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden z-50">
<div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full relative max-h-[90vh] overflow-y-auto">
  <button id="close-modal-btn" class="absolute top-3 right-4 text-gray-500 hover:text-gray-800 text-4xl font-light">&times;</button>
  <div id="modal-content" class="p-8"></div>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const categoriesContainer = document.querySelector('#categories-container ul');
  const plantsContainer = document.getElementById('plants-container');
  const cartItemsContainer = document.getElementById('cart-items-container');
  const cartTotalEl = document.getElementById('cart-total');
  const spinner = document.getElementById('spinner');
  const modal = document.getElementById('plant-modal');
  const modalContent = document.getElementById('modal-content');
  const closeModalBtn = document.getElementById('close-modal-btn');

  const API_BASE = 'https://openapi.programming-hero.com/api';
  const API_CATEGORIES = `${API_BASE}/categories`;
  const API_ALL_PLANTS = `${API_BASE}/plants`;
  const API_PLANTS_BY_CATEGORY = `${API_BASE}/category/`;

  let cart = [];

  const toggleSpinner = (show) => {
    spinner.classList.toggle('hidden', !show);
    plantsContainer.classList.toggle('hidden', show);
  };

  const handleFetchError = (error) => {
    console.error(error);
    toggleSpinner(false);
    plantsContainer.innerHTML = `<p class="text-red-700 text-center">Failed to load plants.</p>`;
  };

  const renderCategories = (data) => {
    const cats = data.categories || [];
    const allBtn = `<li><button data-id="all" class="category-btn w-full text-left p-3 rounded-md active">All Trees</button></li>`;
    categoriesContainer.innerHTML = allBtn + cats.map(c => `<li><button data-id="${c.id}" class="category-btn w-full text-left p-3 rounded-md hover:bg-gray-200">${c.category_name}</button></li>`).join('');
  };

  const renderPlants = (data) => {
    const arr = data.plants || [];
    if (arr.length === 0) {
      plantsContainer.innerHTML = `<p class="text-center text-gray-500 col-span-full">No plants found.</p>`;
      return;
    }
    plantsContainer.innerHTML = arr.map(p => `
      <div class="bg-white rounded-lg shadow-md flex flex-col hover:scale-105 transition-transform cursor-pointer">
        <div class="flex flex-col flex-grow p-4" data-plant-id="${p.id}">
          <img src="${p.image}" alt="${p.name}" class="w-full h-48 object-cover rounded-md">
          <h4 class="font-bold text-lg mt-2">${p.name}</h4>
          <p class="text-gray-600 text-sm mt-1 flex-grow">${p.description.slice(0,100)}...</p>
        </div>
        <div class="mt-4 flex flex-col px-4 pb-4">
          <span class="font-bold text-lg mb-2">$${p.price.toFixed(2)}</span>
          <button class="add-to-cart-btn bg-brand-green text-white py-2 rounded-md hover:bg-green-800 w-full" 
            data-id="${p.id}" data-name="${p.name}" data-price="${p.price}">Add to Cart</button>
        </div>
      </div>
    `).join('');
  };

  const renderCart = () => {
    if (!cart.length) {
      cartItemsContainer.innerHTML = `<p class="text-gray-500">Your cart is empty.</p>`;
    } else {
      cartItemsContainer.innerHTML = cart.map((item,i) => `<div class="flex justify-between items-center">
        <span>${item.name}</span>
        <button class="remove-from-cart-btn text-red-500 font-bold text-xl" data-index="${i}">&times;</button>
      </div>`).join('');
    }
    const total = cart.reduce((s,i)=>s+i.price,0);
    cartTotalEl.textContent = `$${total.toFixed(2)}`;
  };

  // Updated Modal Logic with Add to Cart
  plantsContainer.addEventListener('click', e => {
    // Add to Cart from card
    if (e.target.matches('.add-to-cart-btn')) {
        const { id, name, price } = e.target.dataset;
        cart.push({ id, name, price: parseFloat(price) });
        renderCart();
        return;
    }

    // Open Modal
    const card = e.target.closest('[data-plant-id]');
    if (!card) return;
    const plantId = card.dataset.plantId;

    // Find plant from currently displayed plants
    const plantElements = plantsContainer.querySelectorAll('[data-plant-id]');
    let plantData = null;
    plantElements.forEach(el => {
        if (el.dataset.plantId === plantId) {
            const img = el.querySelector('img').src;
            const name = el.querySelector('h4').innerText;
            const desc = el.querySelector('p').innerText;
            const price = parseFloat(el.parentElement.querySelector('.add-to-cart-btn').dataset.price);
            plantData = { id: plantId, name, description: desc, price, image: img };
        }
    });

    if (plantData) {
        modalContent.innerHTML = `
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
                <img src="${plantData.image}" alt="${plantData.name}" class="w-full h-auto rounded-lg shadow-md">
                <div>
                    <h2 class="text-3xl font-bold text-brand-green mb-2">${plantData.name}</h2>
                    <p class="mb-4">${plantData.description}</p>
                    <p class="font-bold text-2xl text-brand-green mb-4">$${plantData.price.toFixed(2)}</p>
                    <button class="modal-add-to-cart bg-brand-green text-white py-2 px-4 rounded-md hover:bg-green-800 font-bold" 
                      data-id="${plantData.id}" data-name="${plantData.name}" data-price="${plantData.price}">Add to Cart</button>
                </div>
            </div>
        `;
        modal.classList.remove('hidden');
    }
  });

  // Add to Cart from modal
  modalContent.addEventListener('click', e => {
    if (e.target.matches('.modal-add-to-cart')) {
        const { id, name, price } = e.target.dataset;
        cart.push({ id, name, price: parseFloat(price) });
        renderCart();
        modal.classList.add('hidden');
        modalContent.innerHTML = '';
    }
  });

  cartItemsContainer.addEventListener('click', e => {
    if (e.target.matches('.remove-from-cart-btn')) {
      const idx = parseInt(e.target.dataset.index,10);
      cart.splice(idx,1);
      renderCart();
    }
  });

  closeModalBtn.addEventListener('click', ()=>{ modal.classList.add('hidden'); modalContent.innerHTML=''; });
  modal.addEventListener('click', e=>{ if(e.target===modal){ modal.classList.add('hidden'); modalContent.innerHTML=''; }});

  // Categories click
  categoriesContainer.addEventListener('click', async e => {
    if (!e.target.matches('.category-btn')) return;
    document.querySelectorAll('.category-btn').forEach(b=>b.classList.remove('active'));
    e.target.classList.add('active');
    toggleSpinner(true);
    try {
      const url = e.target.dataset.id === 'all' ? API_ALL_PLANTS : API_PLANTS_BY_CATEGORY + e.target.dataset.id;
      const res = await fetch(url);
      const data = await res.json();
      renderPlants(data);
    } catch(err){ handleFetchError(err); }
    finally { toggleSpinner(false); }
  });

  // Initialize
  const init = async ()=>{
    toggleSpinner(true);
    try {
      const catRes = await fetch(API_CATEGORIES);
      const catData = await catRes.json();
      renderCategories(catData);
      const plantRes = await fetch(API_ALL_PLANTS);
      const allPlants = await plantRes.json();
      renderPlants(allPlants);
      renderCart();
    } catch(err){ handleFetchError(err); }
    finally{ toggleSpinner(false); }
  };
  init();
});
</script>

</body>
</html>
